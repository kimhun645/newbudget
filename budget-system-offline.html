<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดทำงบประมาณประจำปี</title>
    <style>
        /* Tailwind CSS - Embedded */
        *,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,"Consolas","Liberation Mono","Menlo",monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}

        /* Custom Styles */
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #ffffff 50%, #eef2ff 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .card-body {
            padding: 1.5rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }

        .btn-lg {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
        }

        .form-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background: white;
            font-size: 0.875rem;
        }

        .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .table th,
        .table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }

        .table tbody tr:hover {
            background: #f9fafb;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            background: white;
            border-radius: 1rem 1rem 0 0;
            overflow-x: auto;
        }

        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.2s;
        }

        .tab:hover {
            color: #3b82f6;
            background: #f9fafb;
        }

        .tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: #eff6ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid {
            display: grid;
            gap: 1rem;
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-center {
            justify-content: center;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .gap-4 {
            gap: 1rem;
        }

        .gap-6 {
            gap: 1.5rem;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mb-6 {
            margin-bottom: 1.5rem;
        }

        .mt-2 {
            margin-top: 0.5rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .mr-2 {
            margin-right: 0.5rem;
        }

        .ml-2 {
            margin-left: 0.5rem;
        }

        .p-2 {
            padding: 0.5rem;
        }

        .p-4 {
            padding: 1rem;
        }

        .p-6 {
            padding: 1.5rem;
        }

        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .py-2 {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }

        .py-4 {
            padding-top: 1rem;
            padding-bottom: 1rem;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .text-lg {
            font-size: 1.125rem;
        }

        .text-xl {
            font-size: 1.25rem;
        }

        .text-2xl {
            font-size: 1.5rem;
        }

        .text-3xl {
            font-size: 1.875rem;
        }

        .text-4xl {
            font-size: 2.25rem;
        }

        .font-medium {
            font-weight: 500;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .text-gray-500 {
            color: #6b7280;
        }

        .text-gray-600 {
            color: #4b5563;
        }

        .text-gray-700 {
            color: #374151;
        }

        .text-gray-800 {
            color: #1f2937;
        }

        .text-gray-900 {
            color: #111827;
        }

        .text-blue-600 {
            color: #2563eb;
        }

        .text-blue-700 {
            color: #1d4ed8;
        }

        .text-green-600 {
            color: #16a34a;
        }

        .text-red-600 {
            color: #dc2626;
        }

        .text-yellow-600 {
            color: #ca8a04;
        }

        .text-yellow-700 {
            color: #a16207;
        }

        .text-yellow-800 {
            color: #854d0e;
        }

        .bg-gray-50 {
            background-color: #f9fafb;
        }

        .bg-blue-50 {
            background-color: #eff6ff;
        }

        .bg-blue-100 {
            background-color: #dbeafe;
        }

        .bg-green-50 {
            background-color: #f0fdf4;
        }

        .bg-green-100 {
            background-color: #dcfce7;
        }

        .bg-yellow-50 {
            background-color: #fefce8;
        }

        .bg-yellow-100 {
            background-color: #fef3c7;
        }

        .bg-red-50 {
            background-color: #fef2f2;
        }

        .border {
            border-width: 1px;
        }

        .border-gray-200 {
            border-color: #e5e7eb;
        }

        .border-gray-300 {
            border-color: #d1d5db;
        }

        .border-blue-200 {
            border-color: #bfdbfe;
        }

        .border-yellow-200 {
            border-color: #fde68a;
        }

        .border-yellow-300 {
            border-color: #fcd34d;
        }

        .rounded {
            border-radius: 0.25rem;
        }

        .rounded-md {
            border-radius: 0.375rem;
        }

        .rounded-lg {
            border-radius: 0.5rem;
        }

        .rounded-xl {
            border-radius: 0.75rem;
        }

        .shadow {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .overflow-x-auto {
            overflow-x: auto;
        }

        .hidden {
            display: none;
        }

        .w-full {
            width: 100%;
        }

        .w-20 {
            width: 5rem;
        }

        .h-4 {
            height: 1rem;
        }

        .h-5 {
            height: 1.25rem;
        }

        .min-h-screen {
            min-height: 100vh;
        }

        .space-y-2 > * + * {
            margin-top: 0.5rem;
        }

        .space-y-4 > * + * {
            margin-top: 1rem;
        }

        .space-y-6 > * + * {
            margin-top: 1.5rem;
        }

        .inline-flex {
            display: inline-flex;
        }

        .cursor-pointer {
            cursor: pointer;
        }

        .select-none {
            user-select: none;
        }

        .transition-all {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms;
        }

        .hover\:bg-gray-100:hover {
            background-color: #f3f4f6;
        }

        .hover\:bg-blue-100:hover {
            background-color: #dbeafe;
        }

        .focus\:outline-none:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
        }

        .focus\:ring-2:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .focus\:ring-blue-500:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .focus\:border-blue-500:focus {
            border-color: #3b82f6;
        }

        /* Icons */
        .icon {
            width: 1rem;
            height: 1rem;
            display: inline-block;
            vertical-align: middle;
        }

        .icon-sm {
            width: 0.875rem;
            height: 0.875rem;
        }

        .icon-lg {
            width: 1.25rem;
            height: 1.25rem;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 50;
            min-width: 300px;
            max-width: 500px;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-50px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
        }

        .toast.error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #991b1b;
        }

        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .spinner {
            width: 3rem;
            height: 3rem;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem 0.5rem;
            }

            .grid-cols-2,
            .grid-cols-3,
            .grid-cols-4 {
                grid-template-columns: 1fr;
            }

            .table {
                font-size: 0.75rem;
            }

            .table th,
            .table td {
                padding: 0.5rem;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }
        }

        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }

            .card {
                box-shadow: none;
                border: 1px solid #e5e7eb;
            }

            .btn {
                display: none;
            }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="min-h-screen">
        <div class="container">
            <!-- Header -->
            <header class="text-center mb-6">
                <h1 class="text-4xl font-bold text-gray-900 mb-2">
                    ระบบจัดทำงบประมาณประจำปี
                </h1>
                <p class="text-gray-600 text-lg">
                    ระบบจัดการและคำนวณงบประมาณอย่างมีประสิทธิภาพ
                </p>
            </header>

            <!-- Tab Navigation -->
            <div class="card">
                <div class="tabs" id="tabNavigation">
                    <div class="tab active" data-tab="budget">
                        <span class="icon mr-2">📊</span>
                        ตารางงบประมาณ
                    </div>
                    <div class="tab" data-tab="config">
                        <span class="icon mr-2">⚙️</span>
                        กำหนดข้อมูล
                    </div>
                    <div class="tab" data-tab="travel">
                        <span class="icon mr-2">🚗</span>
                        คำนวณค่าเดินทาง
                    </div>
                    <div class="tab" data-tab="special-assist">
                        <span class="icon mr-2">❤️</span>
                        เงินช่วยเหลืออื่นๆ
                    </div>
                    <div class="tab" data-tab="family-visit">
                        <span class="icon mr-2">🏠</span>
                        เดินทางเยี่ยมครอบครัว
                    </div>
                    <div class="tab" data-tab="company-trip">
                        <span class="icon mr-2">👥</span>
                        เดินทางร่วมงานวันพนักงาน
                    </div>
                    <div class="tab" data-tab="manager-rotation">
                        <span class="icon mr-2">🔄</span>
                        เดินทางหมุนเวียน ผจศ.
                    </div>
                    <div class="tab" data-tab="special-assist-1">
                        <span class="icon mr-2">💰</span>
                        เงินช่วยเหลือพิเศษ
                    </div>
                    <div class="tab" data-tab="overtime">
                        <span class="icon mr-2">⏰</span>
                        ค่าล่วงเวลาทำงานวันหยุด
                    </div>
                    <div class="tab" data-tab="workday-calc">
                        <span class="icon mr-2">📅</span>
                        คำนวณวันทำงาน
                    </div>
                </div>

                <!-- Tab Contents -->
                <div class="tab-content active" id="budget">
                    <div class="card-header">
                        <div class="flex justify-center items-center gap-6">
                            <div class="flex items-center gap-3">
                                <label class="font-semibold">เปรียบเทียบปี:</label>
                                <select id="currentYear" class="form-select">
                                    <option value="2568">2568</option>
                                    <option value="2569">2569</option>
                                    <option value="2570">2570</option>
                                    <option value="2571">2571</option>
                                    <option value="2572">2572</option>
                                    <option value="2573">2573</option>
                                    <option value="2574">2574</option>
                                    <option value="2575">2575</option>
                                    <option value="2576">2576</option>
                                    <option value="2577">2577</option>
                                    <option value="2578">2578</option>
                                    <option value="2579">2579</option>
                                    <option value="2580">2580</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-3">
                                <label class="font-semibold">กับปี:</label>
                                <select id="nextYear" class="form-select">
                                    <option value="2568">2568</option>
                                    <option value="2569" selected>2569</option>
                                    <option value="2570">2570</option>
                                    <option value="2571">2571</option>
                                    <option value="2572">2572</option>
                                    <option value="2573">2573</option>
                                    <option value="2574">2574</option>
                                    <option value="2575">2575</option>
                                    <option value="2576">2576</option>
                                    <option value="2577">2577</option>
                                    <option value="2578">2578</option>
                                    <option value="2579">2579</option>
                                    <option value="2580">2580</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="overflow-x-auto">
                            <table class="table" id="budgetTable">
                                <thead>
                                    <tr>
                                        <th style="width: 8%">รหัสบัญชี</th>
                                        <th style="width: 35%">รายการ</th>
                                        <th style="width: 18%" class="text-center">งบประมาณปี <span id="currentYearHeader">2568</span></th>
                                        <th style="width: 18%" class="text-center">คำของบประมาณปี <span id="nextYearHeader">2569</span></th>
                                        <th style="width: 12%" class="text-right">ผลต่าง (+/-)</th>
                                        <th style="width: 9%" class="text-center">หมายเหตุ</th>
                                    </tr>
                                </thead>
                                <tbody id="budgetTableBody">
                                    <!-- Budget items will be populated here -->
                                </tbody>
                                <tfoot>
                                    <tr class="font-bold bg-gray-50">
                                        <td colspan="2" class="text-lg">ยอดรวมทั้งหมด</td>
                                        <td class="text-right text-lg" id="totalCurrent">0.00</td>
                                        <td class="text-right text-lg" id="totalNext">0.00</td>
                                        <td class="text-right text-lg" id="totalDiff">0.00</td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="flex justify-between items-center mt-6 pt-6 border-t border-gray-200">
                            <div class="flex gap-4">
                                <button class="btn btn-primary" onclick="saveData()">
                                    <span class="icon mr-2">💾</span>
                                    บันทึก
                                </button>
                                <button class="btn btn-success" onclick="exportBudgetToExcel()">
                                    <span class="icon mr-2">📊</span>
                                    ส่งออกเป็น Excel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="config">
                    <div class="card-header">
                        <h3 class="text-xl font-semibold">กำหนดข้อมูลพื้นฐาน</h3>
                    </div>
                    <div class="card-body space-y-6">
                        <!-- Master Rates Table -->
                        <div>
                            <h4 class="text-lg font-semibold mb-4">ตารางอัตราค่าใช้จ่ายมาตรฐาน</h4>
                            <div class="overflow-x-auto">
                                <table class="table" id="masterRatesTable">
                                    <thead>
                                        <tr>
                                            <th>ตำแหน่ง</th>
                                            <th>ระดับ</th>
                                            <th class="text-right">ค่าเช่าบ้าน</th>
                                            <th class="text-right">เงินช่วยเหลือรายเดือน</th>
                                            <th class="text-right">ค่าซื้อของเหมาจ่าย</th>
                                            <th class="text-right">ค่ารถประจำทาง โคราช - กทม</th>
                                            <th class="text-right">ค่ารถรับจ้าง ขนส่ง-ที่พัก</th>
                                            <th class="text-right">ค่าเบี้ยเลี้ยง</th>
                                            <th class="text-right">ค่าที่พัก</th>
                                        </tr>
                                    </thead>
                                    <tbody id="masterRatesTableBody">
                                        <!-- Master rates will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Employee Management -->
                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-semibold">รายชื่อพนักงาน</h4>
                                <div class="flex gap-3">
                                    <input type="file" id="importFile" accept=".xlsx,.xls" class="hidden" onchange="importEmployees(event)">
                                    <button class="btn btn-secondary btn-sm" onclick="document.getElementById('importFile').click()">
                                        <span class="icon mr-2">📤</span>
                                        นำเข้าข้อมูล
                                    </button>
                                    <button class="btn btn-success btn-sm" onclick="exportEmployeesToExcel()">
                                        <span class="icon mr-2">📥</span>
                                        ส่งออกข้อมูล
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="resetAllData()">
                                        <span class="icon mr-2">🔄</span>
                                        ล้างข้อมูลทั้งหมด
                                    </button>
                                </div>
                            </div>

                            <!-- Employee Selection Controls -->
                            <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg mb-4">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h5 class="font-semibold text-blue-700 text-lg flex items-center">
                                            <span class="icon mr-2">✅</span>
                                            เลือกพนักงานสำหรับการคำนวณ
                                        </h5>
                                        <p class="text-sm text-blue-700">
                                            เลือกแล้ว <span id="selectedCount">0</span> คน จากทั้งหมด <span id="totalCount">0</span> คน
                                            (ใช้สำหรับการคำนวณทุกประเภท)
                                        </p>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="btn btn-secondary btn-sm" onclick="selectAllEmployees()">
                                            <span class="icon mr-1">✅</span>
                                            เลือกทั้งหมด
                                        </button>
                                        <button class="btn btn-secondary btn-sm" onclick="selectNoEmployees()">
                                            <span class="icon mr-1">❌</span>
                                            ยกเลิกทั้งหมด
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="overflow-x-auto">
                                <table class="table" id="employeeTable">
                                    <thead>
                                        <tr>
                                            <th class="text-center" style="width: 5%">
                                                <input type="checkbox" id="selectAllCheckbox" onchange="toggleAllEmployees(this.checked)">
                                            </th>
                                            <th>รหัสพนักงาน</th>
                                            <th>ชื่อ-สกุล</th>
                                            <th>เพศ</th>
                                            <th>ปีเริ่มงาน</th>
                                            <th>ระดับ</th>
                                            <th>จังหวัดเยี่ยมบ้าน</th>
                                            <th class="text-right">ค่ารถทัวร์เยี่ยมบ้าน</th>
                                            <th class="text-center">จัดการ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="employeeTableBody">
                                        <!-- Employees will be populated here -->
                                    </tbody>
                                </table>
                            </div>

                            <div class="flex justify-between items-center mt-6">
                                <button class="btn btn-primary" onclick="addEmployee()">
                                    <span class="icon mr-2">➕</span>
                                    เพิ่มพนักงาน
                                </button>
                                <button class="btn btn-primary btn-lg" onclick="saveData()">
                                    <span class="icon mr-2">💾</span>
                                    บันทึกทั้งหมด
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="travel">
                    <div class="card-header">
                        <div class="flex justify-between items-center">
                            <h3 class="text-xl font-semibold">สรุปค่าใช้จ่ายเดินทางเพื่อรับของที่ระลึก</h3>
                            <div class="flex items-center gap-4">
                                <button class="btn btn-secondary btn-sm" onclick="changeTravelYear(-1)">
                                    <span class="icon mr-1">⬅️</span>
                                    ปีก่อนหน้า
                                </button>
                                <div class="text-center">
                                    <div class="text-sm">คำนวณสำหรับปี พ.ศ.</div>
                                    <div class="text-xl font-bold text-blue-600" id="travelCalcYear">2569</div>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="changeTravelYear(1)">
                                    ปีถัดไป
                                    <span class="icon ml-1">➡️</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="bg-blue-50 p-4 rounded-lg mb-4">
                            <div class="flex items-start gap-2">
                                <span class="icon text-blue-600">ℹ️</span>
                                <div class="text-sm text-blue-700">
                                    <p class="font-semibold mb-2">เกณฑ์การคำนวณ:</p>
                                    <ul class="space-y-1 text-xs">
                                        <li>• แสดงเฉพาะพนักงานที่มีอายุงาน 20, 25, 30, 35, หรือ 40 ปี</li>
                                        <li>• ค่าที่พัก, ค่าเบี้ยเลี้ยง, ค่าเดินทาง: อ้างอิงจากตารางอัตราค่าใช้จ่ายมาตรฐาน</li>
                                        <li>• จำนวนวัน/คืน: สามารถแก้ไขได้</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                            <h5 class="font-semibold text-yellow-800 mb-3">จำนวนวัน/คืน (ใช้สำหรับทุกคน)</h5>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm text-yellow-700">จำนวนคืนที่พัก</label>
                                    <div class="mt-1 flex items-center gap-2">
                                        <input type="number" id="hotelNights" value="2" class="form-input w-20" onchange="updateTravelCalculation()">
                                        <span class="text-sm text-yellow-700">คืน</span>
                                    </div>
                                </div>
                                <div>
                                    <label class="text-sm text-yellow-700">จำนวนวันเบี้ยเลี้ยง</label>
                                    <div class="mt-1 flex items-center gap-2">
                                        <input type="number" id="perDiemDays" value="3" class="form-input w-20" onchange="updateTravelCalculation()">
                                        <span class="text-sm text-yellow-700">วัน</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="table" id="travelTable">
                                <thead>
                                    <tr>
                                        <th>รหัสพนักงาน</th>
                                        <th>ชื่อ-สกุล</th>
                                        <th class="text-center">อายุงาน (ปี)</th>
                                        <th class="text-right">ค่าที่พัก</th>
                                        <th class="text-right">ค่าเบี้ยเลี้ยง</th>
                                        <th class="text-right">ค่ารถประจำทาง โคราช - กทม (ไป-กลับ)</th>
                                        <th class="text-right">ค่ารถรับจ้าง ขนส่ง-ที่พัก (ไป-กลับ)</th>
                                        <th class="text-right font-semibold">รวม (บาท)</th>
                                    </tr>
                                </thead>
                                <tbody id="travelTableBody">
                                    <!-- Travel data will be populated here -->
                                </tbody>
                            </table>
                        </div>

                        <div class="flex justify-between items-center mt-6 pt-6 border-t border-gray-200">
                            <div class="flex items-center gap-4">
                                <span class="text-lg font-semibold">ยอดรวมทั้งหมด:</span>
                                <span class="text-2xl font-bold text-blue-600" id="travelTotal">0.00 บาท</span>
                            </div>
                            <button class="btn btn-primary" onclick="saveData()">
                                <span class="icon mr-2">💾</span>
                                บันทึก
                            </button>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="special-assist">
                    <div class="card-header">
                        <h3 class="text-xl font-semibold">สรุปยอดเงินช่วยเหลืออื่นๆ</h3>
                        <p class="text-sm mt-2">แสดงเฉพาะพนักงานที่มีจังหวัดเยี่ยมบ้าน (ไม่ใช่ขอนแก่น และไม่ใช่ท้องถิ่น)</p>
                    </div>
                    <div class="card-body">
                        <div class="bg-blue-50 p-4 rounded-lg mb-4">
                            <div class="flex items-start gap-2">
                                <span class="icon text-blue-600">ℹ️</span>
                                <div class="text-sm text-blue-700">
                                    <p class="font-semibold mb-2">เกณฑ์การคำนวณ:</p>
                                    <ul class="space-y-1 text-xs">
                                        <li>• ค่าเช่าบ้าน, เงินช่วยเหลือรายเดือน: อ้างอิงจากตารางอัตราค่าใช้จ่ายมาตรฐาน</li>
                                        <li>• จำนวนเดือน: สามารถแก้ไขได้ (ค่าเริ่มต้น 12 เดือน)</li>
                                        <li>• ค่าซื้อของเหมาจ่าย: สามารถแก้ไขได้ (ค่าเริ่มต้น 0 บาท)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="table" id="specialAssistTable">
                                <thead>
                                    <tr>
                                        <th>รหัสพนักงาน</th>
                                        <th>ชื่อ-สกุล</th>
                                        <th>จังหวัดเยี่ยมบ้าน</th>
                                        <th class="text-right">ค่าเช่าบ้าน</th>
                                        <th class="text-right">เงินช่วยเหลือรายเดือน</th>
                                        <th class="text-right">ค่าซื้อของเหมาจ่าย</th>
                                        <th class="text-right font-semibold">รวม (บาท)</th>
                                    </tr>
                                </thead>
                                <tbody id="specialAssistTableBody">
                                    <!-- Special assist data will be populated here -->
                                </tbody>
                            </table>
                        </div>

                        <div class="flex justify-between items-center mt-6 pt-6 border-t border-gray-200">
                            <div class="flex items-center gap-4">
                                <span class="text-lg font-semibold">ยอดรวมทั้งหมด:</span>
                                <span class="text-2xl font-bold text-blue-600" id="specialAssistTotal">0.00 บาท</span>
                            </div>
                            <button class="btn btn-primary" onclick="saveData()">
                                <span class="icon mr-2">💾</span>
                                บันทึก
                            </button>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="family-visit">
                    <div class="card-header">
                        <h3 class="text-xl font-semibold">สรุปค่าเดินทางเยี่ยมครอบครัว</h3>
                        <p class="text-sm mt-2">แสดงเฉพาะพนักงานที่มีจังหวัดเยี่ยมบ้าน (ไม่ใช่ขอนแก่น และไม่ใช่ท้องถิ่น)</p>
                    </div>
                    <div class="card-body">
                        <div class="bg-blue-50 p-4 rounded-lg mb-4">
                            <div class="flex items-start gap-2">
                                <span class="icon text-blue-600">ℹ️</span>
                                <div class="text-sm text-blue-700">
                                    <p class="font-semibold mb-2">เกณฑ์การคำนวณ:</p>
                                    <ul class="space-y-1 text-xs">
                                        <li>• ค่ารถทัวร์เยี่ยมบ้าน: สามารถแก้ไขได้ในตารางข้อมูลพนักงาน</li>
                                        <li>• คำนวณจาก: ค่ารถทัวร์ต่อครั้ง × 4 ครั้ง × 2 เที่ยว (ไป-กลับ)</li>
                                        <li>• แสดงเฉพาะพนักงานที่ไม่ใช่สถานะ "ท้องถิ่น" และจังหวัดไม่ใช่ "ขอนแก่น"</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="table" id="familyVisitTable">
                                <thead>
                                    <tr>
                                        <th>รหัสพนักงาน</th>
                                        <th>ชื่อ-สกุล</th>
                                        <th>จังหวัดเยี่ยมบ้าน</th>
                                        <th class="text-right">ค่ารถทัวร์เยี่ยมบ้าน (ต่อครั้ง)</th>
                                        <th class="text-right">ค่ารถทัวร์เยี่ยมบ้าน (4 ครั้ง × 2 เที่ยว)</th>
                                        <th class="text-right font-semibold">รวม (บาท)</th>
                                    </tr>
                                </thead>
                                <tbody id="familyVisitTableBody">
                                    <!-- Family visit data will be populated here -->
                                </tbody>
                            </table>
                        </div>

                        <div class="flex justify-between items-center mt-6 pt-6 border-t border-gray-200">
                            <div class="flex items-center gap-4">
                                <span class="text-lg font-semibold">ยอดรวมทั้งหมด:</span>
                                <span class="text-2xl font-bold text-blue-600" id="familyVisitTotal">0.00 บาท</span>
                            </div>
                            <button class="btn btn-primary" onclick="saveData()">
                                <span class="icon mr-2">💾</span>
                                บันทึก
                            </button>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="company-trip">
                    <div class="card-header">
                        <h3 class="text-xl font-semibold">สรุปค่าเดินทางร่วมงานวันพนักงาน</h3>
                    </div>
                    <div class="card-body">
                        <div class="bg-blue-50 p-4 rounded-lg mb-4">
                            <div class="flex items-start gap-2">
                                <span class="icon text-blue-600">ℹ️</span>
                                <div class="text-sm text-blue-700">
                                    <p class="font-semibold mb-2">เกณฑ์การคำนวณ:</p>
                                    <ul class="space-y-1 text-xs">
                                        <li>• ค่ารถทัวร์: ค่าคงที่ (สามารถแก้ไขได้)</li>
                                        <li>• ค่าที่พัก: อ้างอิงจากตารางอัตราค่าใช้จ่ายมาตรฐาน</li>
                                        <li>• ผู้บริหารระดับ 7: พักเดี่ยว</li>
                                        <li>• พนักงานอื่นๆ: จับคู่พักตามเพศ (ใช้อัตราสูงสุดของคู่)</li>
                                        <li>• พนักงานท้องถิ่น/ขอนแก่น: ไม่คิดค่าที่พัก</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h5 class="font-semibold text-yellow-800">ค่ารถทัวร์ (ทุกคน)</h5>
                                    <p class="text-sm text-yellow-700">ค่าคงที่สำหรับทุกคน</p>
                                </div>
                                <div class="text-right">
                                    <input type="number" id="companyTripBusFare" value="600" class="form-input w-20 text-right" onchange="updateCompanyTripCalculation()">
                                    <div class="text-xs text-orange-600 mt-1">แก้ไขได้</div>
                                </div>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="table" id="companyTripTable">
                                <thead>
                                    <tr>
                                        <th>รหัสพนักงาน</th>
                                        <th>ชื่อ-สกุล</th>
                                        <th class="text-right">ค่ารถทัวร์</th>
                                        <th class="text-right">ค่าที่พัก</th>
                                        <th class="text-right font-semibold">รวม (บาท)</th>
                                    </tr>
                                </thead>
                                <tbody id="companyTripTableBody">
                                    <!-- Company trip data will be populated here -->
                                </tbody>
                            </table>
                        </div>

                        <div class="flex justify-between items-center mt-6 pt-6 border-t border-gray-200">
                            <div class="flex items-center gap-4">
                                <span class="text-lg font-semibold">ยอดรวมทั้งหมด:</span>
                                <span class="text-2xl font-bold text-blue-600" id="companyTripTotal">0.00 บาท</span>
                            </div>
                            <button class="btn btn-primary" onclick="saveData()">
                                <span class="icon mr-2">💾</span>
                                บันทึก
                            </button>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="manager-rotation">
                    <div class="card-header">
                        <h3 class="text-xl font-semibold">สรุปค่าเดินทางหมุนเวียนงาน ผจศ. ระดับ 7</h3>
                    </div>
                    <div class="card-body">
                        <div class="bg-blue-50 p-4 rounded-lg mb-4">
                            <div class="flex items-start gap-2">
                                <span class="icon text-blue-600">ℹ️</span>
                                <div class="text-sm text-blue-700">
                                    <p class="font-semibold mb-2">เกณฑ์การคำนวณ:</p>
                                    <ul class="space-y-1 text-xs">
                                        <li>• แสดงเฉพาะพนักงานระดับ 7</li>
                                        <li>• ค่าเบี้ยเลี้ยง, ค่าที่พัก: อ้างอิงจากตารางอัตราค่าใช้จ่ายมาตรฐาน</li>
                                        <li>• ค่าเดินทาง: ค่าคงที่ (สามารถแก้ไขได้)</li>
                                        <li>• ระยะเวลา: เบี้ยเลี้ยง 7 วัน, ที่พัก 6 คืน</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                            <h5 class="font-semibold text-yellow-800 mb-3">ค่าเดินทาง (ค่าคงที่)</h5>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="text-sm text-yellow-700">ค่ารถประจำทาง</label>
                                    <div class="mt-1">
                                        <input type="number" id="managerBusCost" value="600" class="form-input" onchange="updateManagerRotationCalculation()">
                                        <div class="text-xs text-orange-600 mt-1">แก้ไขได้</div>
                                    </div>
                                </div>
                                <div>
                                    <label class="text-sm text-yellow-700">ค่าเครื่องบิน</label>
                                    <div class="mt-1">
                                        <input type="number" id="managerFlightCost" value="4000" class="form-input" onchange="updateManagerRotationCalculation()">
                                        <div class="text-xs text-orange-600 mt-1">แก้ไขได้</div>
                                    </div>
                                </div>
                                <div>
                                    <label class="text-sm text-yellow-700">ค่ารถรับจ้าง</label>
                                    <div class="mt-1">
                                        <input type="number" id="managerTaxiCost" value="1000" class="form-input" onchange="updateManagerRotationCalculation()">
                                        <div class="text-xs text-orange-600 mt-1">แก้ไขได้</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="table" id="managerRotationTable">
                                <thead>
                                    <tr>
                                        <th>รหัสพนักงาน</th>
                                        <th>ชื่อ-สกุล</th>
                                        <th class="text-right">ค่าเบี้ยเลี้ยง (7 วัน)</th>
                                        <th class="text-right">ค่าที่พัก (6 คืน)</th>
                                        <th class="text-right">ค่ารถประจำทาง โคราช - กทม</th>
                                        <th class="text-right">ค่ารถรับจ้าง ขนส่ง-ที่พัก</th>
                                        <th class="text-right font-semibold">รวม (บาท)</th>
                                    </tr>
                                </thead>
                                <tbody id="managerRotationTableBody">
                                    <!-- Manager rotation data will be populated here -->
                                </tbody>
                            </table>
                        </div>

                        <div class="flex justify-between items-center mt-6 pt-6 border-t border-gray-200">
                            <div class="flex items-center gap-4">
                                <span class="text-lg font-semibold">ยอดรวมทั้งหมด:</span>
                                <span class="text-2xl font-bold text-blue-600" id="managerRotationTotal">0.00 บาท</span>
                            </div>
                            <button class="btn btn-primary" onclick="saveData()">
                                <span class="icon mr-2">💾</span>
                                บันทึก
                            </button>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="special-assist-1">
                    <div class="card-header">
                        <div class="flex justify-between items-center">
                            <h3 class="text-xl font-semibold">เงินช่วยเหลือพิเศษ</h3>
                            <div class="flex items-center gap-4">
                                <button class="btn btn-secondary btn-sm" onclick="changeSpecialAssist1Year(-1)">
                                    <span class="icon mr-1">⬅️</span>
                                    ปีก่อนหน้า
                                </button>
                                <div class="text-center">
                                    <div class="text-sm">คำนวณสำหรับปี พ.ศ.</div>
                                    <div class="text-xl font-bold text-blue-600" id="specialAssist1CalcYear">2569</div>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="changeSpecialAssist1Year(1)">
                                    ปีถัดไป
                                    <span class="icon ml-1">➡️</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="bg-blue-50 p-4 rounded-lg mb-4">
                            <div class="flex items-start gap-2">
                                <span class="icon text-blue-600">ℹ️</span>
                                <div class="text-sm text-blue-700">
                                    <p class="font-semibold mb-2">รายการเงินช่วยเหลือพิเศษ:</p>
                                    <ul class="space-y-1 text-xs">
                                        <li>• ค่าใช้จ่ายสำหรับงานพิเศษและการควบคุมงานต่างๆ</li>
                                        <li>• สามารถแก้ไขรายการ จำนวนครั้ง วัน คน และอัตราได้</li>
                                        <li>• คำนวณจาก: จำนวนครั้งต่อปี × จำนวนวัน × จำนวนคน × อัตราต่อวัน</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-end mb-4">
                            <button class="btn btn-primary btn-sm" onclick="addSpecialAssist1Item()">
                                <span class="icon mr-2">➕</span>
                                เพิ่มรายการ
                            </button>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="table" id="specialAssist1Table">
                                <thead>
                                    <tr>
                                        <th>รายการ</th>
                                        <th class="text-center">จำนวนครั้งต่อปี</th>
                                        <th class="text-center">จำนวนวัน</th>
                                        <th class="text-center">จำนวนคน</th>
                                        <th class="text-right">อัตราต่อวัน (บาท)</th>
                                        <th class="text-right">รวม (บาท)</th>
                                        <th class="text-center">จัดการ</th>
                                    </tr>
                                </thead>
                                <tbody id="specialAssist1TableBody">
                                    <!-- Special assist 1 data will be populated here -->
                                </tbody>
                            </table>
                        </div>

                        <div class="mt-6 pt-6 border-t border-gray-200">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">หมายเหตุ</label>
                                <textarea id="specialAssist1Notes" class="form-input" rows="3" placeholder="ระบุหมายเหตุเพิ่มเติม..."></textarea>
                            </div>

                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-4">
                                    <span class="text-lg font-semibold">ยอดรวมทั้งหมด:</span>
                                    <span class="text-2xl font-bold text-blue-600" id="specialAssist1Total">0.00 บาท</span>
                                </div>
                                <button class="btn btn-primary" onclick="saveData()">
                                    <span class="icon mr-2">💾</span>
                                    บันทึก
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="overtime">
                    <div class="card-header">
                        <div class="flex justify-between items-center">
                            <h3 class="text-xl font-semibold">ค่าล่วงเวลาทำงานวันหยุด</h3>
                            <div class="flex items-center gap-4">
                                <button class="btn btn-secondary btn-sm" onclick="changeOvertimeYear(-1)">
                                    <span class="icon mr-1">⬅️</span>
                                    ปีก่อนหน้า
                                </button>
                                <div class="text-center">
                                    <div class="text-sm">คำนวณสำหรับปี พ.ศ.</div>
                                    <div class="text-xl font-bold text-blue-600" id="overtimeCalcYear">2569</div>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="changeOvertimeYear(1)">
                                    ปีถัดไป
                                    <span class="icon ml-1">➡️</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="bg-blue-50 p-4 rounded-lg mb-4">
                            <div class="flex items-start gap-2">
                                <span class="icon text-blue-600">ℹ️</span>
                                <div class="text-sm text-blue-700">
                                    <p class="font-semibold mb-2">การคำนวณค่าล่วงเวลา:</p>
                                    <ul class="space-y-1 text-xs">
                                        <li>• อัตราล่วงเวลา = (เงินเดือน ÷ 30 วัน ÷ 8 ชั่วโมง) × 1.5</li>
                                        <li>• คำนวณจาก: จำนวนครั้ง × จำนวนวัน × จำนวนชั่วโมง × จำนวนคน × อัตราล่วงเวลา</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h5 class="font-semibold text-yellow-800">เงินเดือนอ้างอิง</h5>
                                    <p class="text-sm text-yellow-700">ใช้สำหรับคำนวณอัตราล่วงเวลา</p>
                                </div>
                                <div class="text-right">
                                    <input type="number" id="overtimeSalary" value="15000" class="form-input w-32 text-right" onchange="updateOvertimeCalculation()">
                                    <div class="text-xs text-orange-600 mt-1">แก้ไขได้</div>
                                    <div class="text-xs text-gray-600 mt-1">
                                        อัตราล่วงเวลา: <span id="overtimeRate">937.50</span>/ชั่วโมง
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-end mb-4">
                            <button class="btn btn-primary btn-sm" onclick="addOvertimeItem()">
                                <span class="icon mr-2">➕</span>
                                เพิ่มรายการ
                            </button>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="table" id="overtimeTable">
                                <thead>
                                    <tr>
                                        <th>รายการ</th>
                                        <th class="text-center">จำนวนครั้ง</th>
                                        <th class="text-center">จำนวนวัน</th>
                                        <th class="text-center">จำนวนชั่วโมง</th>
                                        <th class="text-center">จำนวนคน</th>
                                        <th class="text-right">อัตราล่วงเวลา (บาท/ชม.)</th>
                                        <th class="text-right">รวม (บาท)</th>
                                        <th class="text-center">จัดการ</th>
                                    </tr>
                                </thead>
                                <tbody id="overtimeTableBody">
                                    <!-- Overtime data will be populated here -->
                                </tbody>
                            </table>
                        </div>

                        <div class="flex justify-between items-center mt-6 pt-6 border-t border-gray-200">
                            <div class="flex items-center gap-4">
                                <span class="text-lg font-semibold">ยอดรวมทั้งหมด:</span>
                                <span class="text-2xl font-bold text-blue-600" id="overtimeTotal">0.00 บาท</span>
                            </div>
                            <button class="btn btn-primary" onclick="saveData()">
                                <span class="icon mr-2">💾</span>
                                บันทึก
                            </button>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="workday-calc">
                    <div class="card-header">
                        <div class="flex justify-between items-center">
                            <h3 class="text-xl font-semibold">คำนวณและจัดการวันทำงานประจำปี</h3>
                            <div class="flex items-center gap-4">
                                <button class="btn btn-secondary btn-sm" onclick="changeWorkdayYear(-1)">
                                    <span class="icon mr-1">⬅️</span>
                                    ปีก่อนหน้า
                                </button>
                                <div class="text-center">
                                    <div class="text-sm">คำนวณสำหรับปี พ.ศ.</div>
                                    <div class="text-xl font-bold text-blue-600" id="workdayCalcYear">2569</div>
                                </div>
                                <button class="btn btn-secondary btn-sm" onclick="changeWorkdayYear(1)">
                                    ปีถัดไป
                                    <span class="icon ml-1">➡️</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="grid grid-cols-1 gap-6">
                            <!-- Results Section -->
                            <div>
                                <div id="workdayResults" class="bg-blue-50 p-6 rounded-lg">
                                    <div class="flex items-center gap-2 mb-4">
                                        <span class="icon text-blue-600">📅</span>
                                        <h4 class="text-xl font-bold text-blue-800">
                                            สรุปวันทำงานปี พ.ศ. <span id="workdayResultYear">2569</span>
                                        </h4>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4 text-base">
                                        <span class="font-semibold">วันทำงาน (จันทร์-ศุกร์):</span>
                                        <span class="text-right" id="totalWeekdays">0</span>
                                        
                                        <span class="font-semibold">วันหยุดที่ตกในวันทำงาน:</span>
                                        <span class="text-right text-red-600" id="holidaysOnWeekdays">0</span>
                                    </div>
                                    
                                    <div class="border-t border-blue-200 pt-4 mt-4 flex justify-between items-center text-xl font-bold">
                                        <span>สรุปวันทำงานจริง:</span>
                                        <span class="text-blue-700" id="actualWorkdays">0</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Holiday Management Section -->
                            <div>
                                <h4 class="text-xl font-bold text-gray-800 mb-4">
                                    จัดการวันหยุดสถาบันการเงิน
                                </h4>
                                
                                <!-- Add Holiday Form -->
                                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                                    <h5 class="font-semibold mb-3">เพิ่มวันหยุดใหม่</h5>
                                    <div class="flex gap-2">
                                        <input type="date" id="newHolidayDate" class="form-input">
                                        <input type="text" id="newHolidayName" placeholder="ชื่อวันหยุด" class="form-input">
                                        <button class="btn btn-primary" onclick="addHoliday()">
                                            <span class="icon mr-1">➕</span>
                                            เพิ่ม
                                        </button>
                                    </div>
                                </div>

                                <!-- Holiday List -->
                                <div id="holidayList" class="space-y-2 max-h-96 overflow-y-auto">
                                    <!-- Holidays will be populated here -->
                                </div>
                            </div>
                        </div>

                        <div class="mt-8 pt-6 border-t border-gray-200 flex justify-end">
                            <button class="btn btn-primary btn-lg" onclick="saveData()">
                                บันทึกข้อมูลวันหยุด
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="toast">
            <div class="flex items-center">
                <span id="toastIcon" class="icon mr-3">✅</span>
                <p id="toastMessage" class="flex-1 text-sm font-medium"></p>
                <button onclick="hideToast()" class="ml-3 p-1 hover:bg-opacity-20 hover:bg-gray-500 rounded transition-all">
                    <span class="icon">❌</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentData = {
            budgetData: [],
            employees: [],
            masterRates: {},
            specialAssist1DataByYear: {},
            overtimeDataByYear: {},
            holidaysData: {},
            selectedEmployees: [],
            currentYear: 2568,
            nextYear: 2569,
            travelCalcYear: 2569,
            specialAssist1CalcYear: 2569,
            overtimeCalcYear: 2569,
            workdayCalcYear: 2569
        };

        // Default data
        const defaultBudgetItems = [
            { type: 'main_header', name: 'รวมงบประมาณรายจ่ายดำเนินงาน' },
            { type: 'header', name: 'หมวด 1 : ค่าใช้จ่ายเกี่ยวกับพนักงาน' },
            { code: '52021100', name: 'ค่าใช้จ่ายกิจกรรมส่งเสริมค่านิยมร่วมขององค์กร', notes: '' },
            { code: '52010700', name: 'ค่าล่วงเวลา', notes: '' },
            { type: 'header', name: 'หมวด 2 : ค่าใช้จ่ายดำเนินงานทั่วไป' },
            { code: '53010200', name: 'ค่าไฟฟ้า', notes: '' },
            { code: '53010300', name: 'ค่าน้ำประปา', notes: '' },
            { code: '53010400', name: 'ค่าโทรศัพท์', notes: '' },
            { code: '53040100', name: 'ค่าวัสดุทั่วไป', notes: '' },
            { code: '53040200', name: 'ค่าวัสดุงานบ้านงานครัว', notes: '' },
            { code: '53050100', name: 'ค่าน้ำมันเชื้อเพลิง', notes: '' },
            { code: '53100001', name: 'ค่าจ้าง', notes: '' },
            { code: '53010100', name: 'ค่าไปรษณียากรและพัสดุไปรษณีย์', notes: '' },
            { code: '53050500', name: 'ค่าขนส่ง', notes: '' },
            { code: '53100400', name: 'ค่าจ้างแรงงานและทำของ', notes: '' },
            { code: '53103900', name: 'ค่าจ้างแรงงาน/ทำของ-งานตามพันธกิจหลัก', notes: '' },
            { code: '53021100', name: 'ค่าซ่อมแซมและบำรุงรักษา', notes: '' },
            { code: '53060600', name: 'ค่าตอบแทน', notes: '' },
            { code: '53100004', name: 'ค่าเช่า', notes: '' },
            { code: '53040300', name: 'ค่าเช่าเครื่องถ่ายเอกสาร', notes: '' },
            { code: '53050200', name: 'ค่าเช่ายานพาหนะ', notes: '' },
            { code: '53070400', name: 'ค่าธรรมเนียม', notes: '' },
            { code: '53100100', name: 'ค่ารับรอง', notes: '' },
            { code: '53100200', name: 'ค่าใช้จ่ายในการเดินทาง', notes: '' },
            { code: '53100201', name: 'ค่าเดินทางเยี่ยมครอบครัว', notes: '' },
            { code: '53100202', name: 'ค่าเดินทางหมุนเวียนงาน ผจศ.', notes: '' },
            { code: '53101000', name: 'ค่าทรัพยากรสาสนเทศห้องสมุด', notes: '' },
            { code: '53103600', name: 'ค่าจัดประชุม/ชี้แจง', notes: '' },
            { code: '53101500', name: 'ค่าใช้จ่ายในการจัดงานและพิธีต่าง ๆ', notes: '' },
            { code: '53109900', name: 'ค่าใช้จ่ายเบ็ดเตล็ด', notes: '' },
            { type: 'header', name: 'หมวด 4 : เงินช่วยเหลือภายในนอกและเงินบริจาค' },
            { code: '55080300', name: 'เงินบริจาค', notes: '' },
            { code: '55080400', name: 'เงินช่วยเหลืออื่นๆ', notes: '' },
            { type: 'header', name: 'หมวด 58: ค่าใช้จ่ายด้านการผลิต' },
            { code: '53110700', name: 'ค่าวัสดุผลิต - ทั่วไป', notes: '' },
            { type: 'main_header', name: 'รวมงบประมาณรายจ่ายสินทรัพย์' },
            { type: 'header', name: 'หมวด 7 : สินทรัพย์ถาวร' },
            { code: '10', name: 'ครุภัณฑ์เครื่องใช้ไฟฟ้าและประปา', notes: '' },
            { code: '16', name: 'ครุภัณฑ์เบ็ดเตล็ด', notes: '' },
            { code: '25', name: 'ครุภัณฑ์ยานพาหนะและขนส่ง', notes: '' },
            { code: '5', name: 'ค่าเสริมสร้างปรับปรุงอาคารสถานที่', notes: '' }
        ];

        const defaultMasterRates = {
            '7': { position: 'ผู้บริหารส่วน', rent: 9500, monthlyAssist: 6250, lumpSum: 8000, travel: 300, local: 250, perDiem: 500, hotel: 2100 },
            '6': { position: 'ผู้บริหารทีม', rent: 9500, monthlyAssist: 6250, lumpSum: 8000, travel: 300, local: 250, perDiem: 500, hotel: 2100 },
            '5.5': { position: 'เจ้าหน้าที่ชำนาญงาน (ควบ)', rent: 9500, monthlyAssist: 6250, lumpSum: 6000, travel: 300, local: 250, perDiem: 500, hotel: 2100 },
            '5': { position: 'เจ้าหน้าที่ชำนาญงาน', rent: 8000, monthlyAssist: 5500, lumpSum: 6000, travel: 300, local: 250, perDiem: 450, hotel: 1800 },
            '4.5': { position: 'เจ้าหน้าที่ (ควบ)', rent: 8000, monthlyAssist: 5500, lumpSum: 6000, travel: 300, local: 250, perDiem: 450, hotel: 1800 },
            '4': { position: 'เจ้าหน้าที่', rent: 8000, monthlyAssist: 5500, lumpSum: 6000, travel: 300, local: 250, perDiem: 450, hotel: 1800 },
            '3': { position: 'พนักงานปฏิบัติการ', rent: 6500, monthlyAssist: 4750, lumpSum: 5000, travel: 300, local: 250, perDiem: 450, hotel: 1800 }
        };

        const defaultEmployees = [
            { id: '62539086', name: 'พัทธดนย์ ทรัพย์ประสม', gender: 'ชาย', startYear: 2539, level: '7', visitProvince: 'พิษณุโลก', homeVisitBusFare: 1200 },
            { id: '52531175', name: 'พีรนุช ธนบดีภัทร', gender: 'หญิง', startYear: 2531, level: '6', visitProvince: 'ขอนแก่น', homeVisitBusFare: 600 },
            { id: '82532130', name: 'นลินรัตน์ ตรีไพศาลศักดิ์', gender: 'หญิง', startYear: 2532, level: '5.5', visitProvince: 'ขอนแก่น', homeVisitBusFare: 0 },
            { id: '42538115', name: 'อุมารักษ์ เตลันยืน', gender: 'หญิง', startYear: 2538, level: 'ท้องถิ่น', visitProvince: '', homeVisitBusFare: 0 },
            { id: '42538092', name: 'สมควร กลิ่นสุคนธ์', gender: 'หญิง', startYear: 2538, level: 'ท้องถิ่น', visitProvince: '', homeVisitBusFare: 0 },
            { id: '52542046', name: 'สรวิชญ์ ธรรศเดชา', gender: 'ชาย', startYear: 2542, level: '5', visitProvince: '', homeVisitBusFare: 600 },
            { id: '22538173', name: 'ประภัสสร เล็กศรีสกุล', gender: 'หญิง', startYear: 2538, level: '5', visitProvince: 'ขอนแก่น', homeVisitBusFare: 600 },
            { id: '82542011', name: 'มลธิรา สุขสำราญ', gender: 'หญิง', startYear: 2542, level: '5', visitProvince: 'ขอนแก่น', homeVisitBusFare: 1200 },
            { id: '42539087', name: 'สุภาณี จำปานุ้ย', gender: 'หญิง', startYear: 2539, level: '5', visitProvince: 'ขอนแก่น', homeVisitBusFare: 600 },
            { id: '62537025', name: 'วิชญ อุปันนัทธ์', gender: 'ชาย', startYear: 2537, level: '5', visitProvince: 'เชียงใหม่', homeVisitBusFare: 600 },
            { id: '82536096', name: 'นุสรา อัศวโชคชัย', gender: 'หญิง', startYear: 2536, level: '5', visitProvince: 'ขอนแก่น', homeVisitBusFare: 600 },
            { id: '72539071', name: 'สันติภาพ ทองประดี', gender: 'ชาย', startYear: 2539, level: '5', visitProvince: 'ขอนแก่น', homeVisitBusFare: 0 },
            { id: '82538194', name: 'ขวัญญาณัฐ จุลเกษม', gender: 'หญิง', startYear: 2538, level: '4.5', visitProvince: 'ขอนแก่น', homeVisitBusFare: 600 },
            { id: '52538087', name: 'สงวน ร้องเกาะเกิด', gender: 'ชาย', startYear: 2538, level: 'ท้องถิ่น', visitProvince: '', homeVisitBusFare: 0 },
            { id: '2539140', name: 'สุมาพร จงภู่', gender: 'หญิง', startYear: 2539, level: '3', visitProvince: 'ขอนแก่น', homeVisitBusFare: 0 },
            { id: '42540033', name: 'คมสันติ์ นุชนารถ', gender: 'ชาย', startYear: 2540, level: 'ท้องถิ่น', visitProvince: '', homeVisitBusFare: 0 },
            { id: '82540031', name: 'พิชิต แจ่มศรี', gender: 'ชาย', startYear: 2540, level: 'ท้องถิ่น', visitProvince: '', homeVisitBusFare: 0 }
        ];

        const defaultSpecialAssist1Data = [
            { item: 'ควบคุมงานบำรุงรักษาระบบไฟฟ้าต้นกำลัง', timesPerYear: 1, days: 2, people: 1, rate: 250 },
            { item: 'ควบคุมงานบำรุงรักษาระบบรักษาความปลอดภัย', timesPerYear: 2, days: 2, people: 1, rate: 250 },
            { item: 'PM เครื่องจักร M7', timesPerYear: 12, days: 2, people: 1, rate: 250 },
            { item: 'Mini Overhaul เครื่อง M7', timesPerYear: 1, days: 2, people: 1, rate: 250 },
            { item: 'พนักงานทำงานผลิต', timesPerYear: 1, days: 242, people: 2, rate: 300 },
            { item: 'พนักงานควบคุมการตรวจจับวันเสาร์ อาทิตย์', timesPerYear: 1, days: 20, people: 1, rate: 300 },
            { item: 'ควบคุมงานล้างบ่อประปา', timesPerYear: 1, days: 2, people: 1, rate: 250 }
        ];

        // Utility functions
        function formatCurrency(num) {
            return new Intl.NumberFormat('th-TH', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(num);
        }

        function getRatesForEmployee(employee) {
            const defaultRates = {
                position: 'ไม่ระบุ',
                rent: 0,
                monthlyAssist: 0,
                lumpSum: 0,
                travel: 0,
                local: 0,
                perDiem: 0,
                hotel: 0
            };
            
            return currentData.masterRates[employee.level] || defaultRates;
        }

        // Storage functions
        function saveData() {
            try {
                localStorage.setItem('budgetSystem_data', JSON.stringify(currentData));
                showToast('บันทึกข้อมูลเรียบร้อยแล้ว', 'success');
            } catch (error) {
                showToast('เกิดข้อผิดพลาดในการบันทึก', 'error');
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('budgetSystem_data');
                if (saved) {
                    const data = JSON.parse(saved);
                    currentData = { ...currentData, ...data };
                } else {
                    // Initialize with defaults
                    initializeDefaultData();
                }
            } catch (error) {
                console.error('Error loading data:', error);
                initializeDefaultData();
            }
        }

        function initializeDefaultData() {
            currentData.budgetData = defaultBudgetItems.map(item => {
                if (item.type) return item;
                const newItem = { ...item, values: {} };
                for (let year = 2568; year <= 2580; year++) {
                    newItem.values[year] = 0;
                }
                return newItem;
            });
            currentData.employees = [...defaultEmployees];
            currentData.masterRates = { ...defaultMasterRates };
            currentData.selectedEmployees = defaultEmployees.map(emp => emp.id);
            currentData.specialAssist1DataByYear = {};
            currentData.overtimeDataByYear = {};
            currentData.holidaysData = {};
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');
            
            toastMessage.textContent = message;
            toastIcon.textContent = type === 'success' ? '✅' : '❌';
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                hideToast();
            }, 3000);
        }

        function hideToast() {
            const toast = document.getElementById('toast');
            toast.classList.remove('show');
        }

        // Tab navigation
        function initializeTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    tab.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                    
                    // Update calculations when switching tabs
                    updateCalculations();
                });
            });
        }

        // Budget table functions
        function renderBudgetTable() {
            const tbody = document.getElementById('budgetTableBody');
            const currentYear = parseInt(document.getElementById('currentYear').value);
            const nextYear = parseInt(document.getElementById('nextYear').value);
            
            document.getElementById('currentYearHeader').textContent = currentYear;
            document.getElementById('nextYearHeader').textContent = nextYear;
            
            let totalCurrent = 0;
            let totalNext = 0;
            
            tbody.innerHTML = '';
            
            currentData.budgetData.forEach((item, index) => {
                const row = document.createElement('tr');
                
                if (item.type) {
                    const headerClass = item.type === 'main_header' 
                        ? 'bg-blue-600 text-white font-bold text-base' 
                        : 'bg-blue-50 font-semibold text-blue-800';
                    
                    row.className = headerClass;
                    row.innerHTML = `<td colspan="6" class="p-4">${item.name}</td>`;
                } else {
                    const currentValue = item.values?.[currentYear] || 0;
                    const nextValue = item.values?.[nextYear] || 0;
                    const diff = nextValue - currentValue;
                    const diffClass = diff > 0 ? 'text-green-600' : diff < 0 ? 'text-red-600' : 'text-gray-500';
                    
                    totalCurrent += currentValue;
                    totalNext += nextValue;
                    
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-4 py-3 font-mono text-sm">${item.code}</td>
                        <td class="px-4 py-3 font-medium">${item.name}</td>
                        <td class="px-4 py-3">
                            <input type="number" class="form-input text-right" 
                                   value="${currentValue}" 
                                   onchange="updateBudgetValue(${index}, ${currentYear}, this.value)">
                        </td>
                        <td class="px-4 py-3">
                            <input type="number" class="form-input text-right" 
                                   value="${nextValue}" 
                                   onchange="updateBudgetValue(${index}, ${nextYear}, this.value)">
                        </td>
                        <td class="px-4 py-3 text-right font-medium ${diffClass}">
                            ${formatCurrency(diff)}
                        </td>
                        <td class="px-4 py-3">
                            <input type="text" class="form-input" 
                                   value="${item.notes || ''}" 
                                   onchange="updateBudgetNotes(${index}, this.value)">
                        </td>
                    `;
                }
                
                tbody.appendChild(row);
            });
            
            // Update totals
            const totalDiff = totalNext - totalCurrent;
            const diffClass = totalDiff > 0 ? 'text-green-600' : totalDiff < 0 ? 'text-red-600' : 'text-gray-500';
            
            document.getElementById('totalCurrent').textContent = formatCurrency(totalCurrent);
            document.getElementById('totalNext').textContent = formatCurrency(totalNext);
            document.getElementById('totalDiff').textContent = formatCurrency(totalDiff);
            document.getElementById('totalDiff').className = `text-right text-lg font-bold ${diffClass}`;
        }

        function updateBudgetValue(index, year, value) {
            if (!currentData.budgetData[index].values) {
                currentData.budgetData[index].values = {};
            }
            currentData.budgetData[index].values[year] = parseFloat(value) || 0;
            renderBudgetTable();
        }

        function updateBudgetNotes(index, notes) {
            currentData.budgetData[index].notes = notes;
        }

        // Master rates table functions
        function renderMasterRatesTable() {
            const tbody = document.getElementById('masterRatesTableBody');
            tbody.innerHTML = '';
            
            Object.keys(currentData.masterRates)
                .sort((a, b) => parseFloat(b) - parseFloat(a))
                .forEach(level => {
                    const data = currentData.masterRates[level];
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="p-3">
                            <input type="text" class="form-input" 
                                   value="${data.position}" 
                                   onchange="updateMasterRate('${level}', 'position', this.value)">
                        </td>
                        <td class="px-4 py-3 text-center font-medium">${level}</td>
                        <td class="p-3">
                            <input type="number" class="form-input text-right" 
                                   value="${data.rent}" 
                                   onchange="updateMasterRate('${level}', 'rent', this.value)">
                        </td>
                        <td class="p-3">
                            <input type="number" class="form-input text-right" 
                                   value="${data.monthlyAssist}" 
                                   onchange="updateMasterRate('${level}', 'monthlyAssist', this.value)">
                        </td>
                        <td class="p-3">
                            <input type="number" class="form-input text-right" 
                                   value="${data.lumpSum}" 
                                   onchange="updateMasterRate('${level}', 'lumpSum', this.value)">
                        </td>
                        <td class="p-3">
                            <input type="number" class="form-input text-right" 
                                   value="${data.travel}" 
                                   onchange="updateMasterRate('${level}', 'travel', this.value)">
                        </td>
                        <td class="p-3">
                            <input type="number" class="form-input text-right" 
                                   value="${data.local}" 
                                   onchange="updateMasterRate('${level}', 'local', this.value)">
                        </td>
                        <td class="p-3">
                            <input type="number" class="form-input text-right" 
                                   value="${data.perDiem}" 
                                   onchange="updateMasterRate('${level}', 'perDiem', this.value)">
                        </td>
                        <td class="p-3">
                            <input type="number" class="form-input text-right" 
                                   value="${data.hotel}" 
                                   onchange="updateMasterRate('${level}', 'hotel', this.value)">
                        </td>
                    `;
                    tbody.appendChild(row);
                });
        }

        function updateMasterRate(level, key, value) {
            if (key === 'position') {
                currentData.masterRates[level][key] = value;
            } else {
                currentData.masterRates[level][key] = parseFloat(value) || 0;
            }
            updateCalculations();
        }

        // Employee table functions
        function renderEmployeeTable() {
            const tbody = document.getElementById('employeeTableBody');
            tbody.innerHTML = '';
            
            const levelOptions = Object.keys(currentData.masterRates).sort((a, b) => parseFloat(b) - parseFloat(a));
            const allLevelOptions = [...levelOptions, 'ท้องถิ่น'];
            
            currentData.employees.forEach((emp, index) => {
                const isSelected = currentData.selectedEmployees.includes(emp.id);
                const row = document.createElement('tr');
                row.className = `border-b border-gray-200 transition-colors ${
                    isSelected ? 'bg-blue-50 hover:bg-blue-100' : 'hover:bg-gray-50'
                }`;
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-center">
                        <input type="checkbox" ${isSelected ? 'checked' : ''} 
                               onchange="toggleEmployeeSelection('${emp.id}', this.checked)">
                    </td>
                    <td class="p-3">
                        <input type="text" class="form-input" 
                               value="${emp.id}" 
                               onchange="updateEmployee(${index}, 'id', this.value)">
                    </td>
                    <td class="p-3">
                        <input type="text" class="form-input" 
                               value="${emp.name}" 
                               onchange="updateEmployee(${index}, 'name', this.value)">
                    </td>
                    <td class="p-3">
                        <select class="form-select" onchange="updateEmployee(${index}, 'gender', this.value)">
                            <option value="ชาย" ${emp.gender === 'ชาย' ? 'selected' : ''}>ชาย</option>
                            <option value="หญิง" ${emp.gender === 'หญิง' ? 'selected' : ''}>หญิง</option>
                        </select>
                    </td>
                    <td class="p-3">
                        <input type="number" class="form-input text-center" 
                               value="${emp.startYear}" 
                               onchange="updateEmployee(${index}, 'startYear', parseInt(this.value))">
                    </td>
                    <td class="p-3">
                        <select class="form-select" onchange="updateEmployee(${index}, 'level', this.value)">
                            ${allLevelOptions.map(level => 
                                `<option value="${level}" ${emp.level === level ? 'selected' : ''}>${level}</option>`
                            ).join('')}
                        </select>
                    </td>
                    <td class="p-3">
                        <input type="text" class="form-input" 
                               value="${emp.visitProvince}" 
                               onchange="updateEmployee(${index}, 'visitProvince', this.value)">
                    </td>
                    <td class="p-3">
                        <input type="number" class="form-input text-right" 
                               value="${emp.homeVisitBusFare}" 
                               onchange="updateEmployee(${index}, 'homeVisitBusFare', parseFloat(this.value) || 0)">
                    </td>
                    <td class="p-3 text-center">
                        <button class="btn btn-danger btn-sm" onclick="deleteEmployee(${index})">
                            <span class="icon">🗑️</span>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            updateEmployeeSelectionCounts();
        }

        function updateEmployee(index, field, value) {
            currentData.employees[index][field] = value;
            updateCalculations();
        }

        function addEmployee() {
            const newEmployee = {
                id: '',
                name: '',
                gender: 'ชาย',
                startYear: new Date().getFullYear() + 543,
                level: '3',
                visitProvince: '',
                homeVisitBusFare: 0
            };
            currentData.employees.unshift(newEmployee);
            renderEmployeeTable();
        }

        function deleteEmployee(index) {
            if (confirm('คุณต้องการลบพนักงานคนนี้ใช่หรือไม่?')) {
                const empId = currentData.employees[index].id;
                currentData.employees.splice(index, 1);
                currentData.selectedEmployees = currentData.selectedEmployees.filter(id => id !== empId);
                renderEmployeeTable();
                updateCalculations();
            }
        }

        function toggleEmployeeSelection(empId, isSelected) {
            if (isSelected) {
                if (!currentData.selectedEmployees.includes(empId)) {
                    currentData.selectedEmployees.push(empId);
                }
            } else {
                currentData.selectedEmployees = currentData.selectedEmployees.filter(id => id !== empId);
            }
            updateEmployeeSelectionCounts();
            updateCalculations();
        }

        function toggleAllEmployees(selectAll) {
            if (selectAll) {
                currentData.selectedEmployees = currentData.employees.map(emp => emp.id);
            } else {
                currentData.selectedEmployees = [];
            }
            renderEmployeeTable();
            updateCalculations();
        }

        function selectAllEmployees() {
            currentData.selectedEmployees = currentData.employees.map(emp => emp.id);
            renderEmployeeTable();
            updateCalculations();
        }

        function selectNoEmployees() {
            currentData.selectedEmployees = [];
            renderEmployeeTable();
            updateCalculations();
        }

        function updateEmployeeSelectionCounts() {
            document.getElementById('selectedCount').textContent = currentData.selectedEmployees.length;
            document.getElementById('totalCount').textContent = currentData.employees.length;
            
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            selectAllCheckbox.checked = currentData.selectedEmployees.length === currentData.employees.length && currentData.employees.length > 0;
        }

        // Travel calculation functions
        function updateTravelCalculation() {
            const tbody = document.getElementById('travelTableBody');
            const hotelNights = parseInt(document.getElementById('hotelNights').value) || 2;
            const perDiemDays = parseInt(document.getElementById('perDiemDays').value) || 3;
            const calcYear = currentData.travelCalcYear;
            
            const eligibleServiceYears = [20, 25, 30, 35, 40];
            const selectedEmployees = currentData.employees.filter(emp => 
                currentData.selectedEmployees.includes(emp.id)
            );
            
            const travelEmployees = selectedEmployees
                .map(emp => ({ ...emp, serviceYears: calcYear - emp.startYear }))
                .filter(emp => eligibleServiceYears.includes(emp.serviceYears));
            
            let total = 0;
            tbody.innerHTML = '';
            
            if (travelEmployees.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center text-gray-500 py-8">
                            ไม่พบพนักงานที่เข้าเกณฑ์สำหรับปี พ.ศ. ${calcYear}
                        </td>
                    </tr>
                `;
            } else {
                travelEmployees.forEach(emp => {
                    const rates = getRatesForEmployee(emp);
                    const hotel = hotelNights * (rates.hotel || 0);
                    const perDiem = perDiemDays * (rates.perDiem || 0);
                    const travelRoundTrip = 2 * (rates.travel || 0);
                    const localRoundTrip = 2 * (rates.local || 0);
                    const empTotal = hotel + perDiem + travelRoundTrip + localRoundTrip;
                    total += empTotal;
                    
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-4 py-3 text-gray-600">${emp.id}</td>
                        <td class="px-4 py-3 font-medium">${emp.name}</td>
                        <td class="px-4 py-3 text-center font-bold text-blue-600">${emp.serviceYears}</td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(hotel)}</div>
                            <div class="text-xs text-gray-500">(${formatCurrency(rates.hotel)} × ${hotelNights} คืน)</div>
                            <div class="text-xs text-blue-600">จากตารางมาตรฐาน</div>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(perDiem)}</div>
                            <div class="text-xs text-gray-500">(${formatCurrency(rates.perDiem)} × ${perDiemDays} วัน)</div>
                            <div class="text-xs text-blue-600">จากตารางมาตรฐาน</div>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(travelRoundTrip)}</div>
                            <div class="text-xs text-gray-500">(${formatCurrency(rates.travel)} × 2 เที่ยว)</div>
                            <div class="text-xs text-blue-600">จากตารางมาตรฐาน</div>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(localRoundTrip)}</div>
                            <div class="text-xs text-gray-500">(${formatCurrency(rates.local)} × 2 เที่ยว)</div>
                            <div class="text-xs text-blue-600">จากตารางมาตรฐาน</div>
                        </td>
                        <td class="px-4 py-3 text-right font-bold">${formatCurrency(empTotal)}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            document.getElementById('travelTotal').textContent = `${formatCurrency(total)} บาท`;
        }

        function changeTravelYear(delta) {
            currentData.travelCalcYear += delta;
            document.getElementById('travelCalcYear').textContent = currentData.travelCalcYear;
            updateTravelCalculation();
        }

        // Special assist calculation functions
        function updateSpecialAssistCalculation() {
            const tbody = document.getElementById('specialAssistTableBody');
            const selectedEmployees = currentData.employees.filter(emp => 
                currentData.selectedEmployees.includes(emp.id) &&
                emp.level !== 'ท้องถิ่น' && 
                emp.visitProvince && 
                emp.visitProvince.trim() !== '' &&
                emp.visitProvince !== 'ขอนแก่น'
            );
            
            let total = 0;
            tbody.innerHTML = '';
            
            if (selectedEmployees.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-gray-500 py-8">
                            ไม่มีข้อมูลพนักงานที่เข้าเกณฑ์
                        </td>
                    </tr>
                `;
            } else {
                selectedEmployees.forEach(emp => {
                    const rates = getRatesForEmployee(emp);
                    const months = 12; // Default months
                    const totalRent = rates.rent * months;
                    const totalMonthlyAssist = rates.monthlyAssist * months;
                    const lumpSum = 0; // Default lump sum
                    const empTotal = totalRent + totalMonthlyAssist + lumpSum;
                    total += empTotal;
                    
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-4 py-3 text-gray-600">${emp.id}</td>
                        <td class="px-4 py-3 font-medium">${emp.name}</td>
                        <td class="px-4 py-3">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                ${emp.visitProvince}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(totalRent)}</div>
                            <div class="text-xs text-gray-500">(${formatCurrency(rates.rent)} × ${months} เดือน)</div>
                            <div class="text-xs text-blue-600">จากตารางมาตรฐาน</div>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(totalMonthlyAssist)}</div>
                            <div class="text-xs text-gray-500">(${formatCurrency(rates.monthlyAssist)} × ${months} เดือน)</div>
                            <div class="text-xs text-blue-600">จากตารางมาตรฐาน</div>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(lumpSum)}</div>
                            <div class="text-xs text-orange-600 mt-1">แก้ไขได้</div>
                        </td>
                        <td class="px-4 py-3 text-right font-bold">${formatCurrency(empTotal)}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            document.getElementById('specialAssistTotal').textContent = `${formatCurrency(total)} บาท`;
        }

        // Family visit calculation functions
        function updateFamilyVisitCalculation() {
            const tbody = document.getElementById('familyVisitTableBody');
            const selectedEmployees = currentData.employees.filter(emp => 
                currentData.selectedEmployees.includes(emp.id) &&
                emp.level !== 'ท้องถิ่น' && 
                emp.visitProvince && 
                emp.visitProvince.trim() !== '' &&
                emp.visitProvince !== 'ขอนแก่น'
            );
            
            let total = 0;
            tbody.innerHTML = '';
            
            if (selectedEmployees.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center text-gray-500 py-8">
                            ไม่พบข้อมูลพนักงานที่เข้าเกณฑ์
                        </td>
                    </tr>
                `;
            } else {
                selectedEmployees.forEach(emp => {
                    const busFareTotal = 4 * (emp.homeVisitBusFare || 0) * 2;
                    total += busFareTotal;
                    
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-4 py-3 text-gray-600">${emp.id}</td>
                        <td class="px-4 py-3 font-medium">${emp.name}</td>
                        <td class="px-4 py-3">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                ${emp.visitProvince}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(emp.homeVisitBusFare)}</div>
                            <div class="text-xs text-orange-600 mt-1">แก้ไขได้</div>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(busFareTotal)}</div>
                            <div class="text-xs text-gray-500">(${formatCurrency(emp.homeVisitBusFare)} × 4 × 2)</div>
                            <div class="text-xs text-blue-600">คำนวณอัตโนมัติ</div>
                        </td>
                        <td class="px-4 py-3 text-right font-bold">${formatCurrency(busFareTotal)}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            document.getElementById('familyVisitTotal').textContent = `${formatCurrency(total)} บาท`;
        }

        // Company trip calculation functions
        function updateCompanyTripCalculation() {
            const tbody = document.getElementById('companyTripTableBody');
            const busFare = parseInt(document.getElementById('companyTripBusFare').value) || 600;
            const selectedEmployees = currentData.employees.filter(emp => 
                currentData.selectedEmployees.includes(emp.id)
            );
            
            let total = 0;
            tbody.innerHTML = '';
            
            if (selectedEmployees.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-gray-500 py-8">
                            ไม่มีข้อมูลพนักงาน
                        </td>
                    </tr>
                `;
            } else {
                selectedEmployees.forEach(emp => {
                    let accommodationCost = 0;
                    let note = 'ไม่คิดค่าที่พัก';
                    
                    if (emp.visitProvince !== 'ขอนแก่น' && emp.level !== 'ท้องถิ่น') {
                        const rates = getRatesForEmployee(emp);
                        accommodationCost = rates.hotel;
                        note = 'พักเดี่ยว';
                    }
                    
                    const empTotal = busFare + accommodationCost;
                    total += empTotal;
                    
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-4 py-3 text-gray-600">${emp.id}</td>
                        <td class="px-4 py-3 font-medium">${emp.name}</td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(busFare)}</div>
                            <div class="text-xs text-orange-600">ค่าคงที่ (แก้ไขได้)</div>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(accommodationCost)}</div>
                            <div class="text-xs text-gray-500">${note}</div>
                        </td>
                        <td class="px-4 py-3 text-right font-bold">${formatCurrency(empTotal)}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            document.getElementById('companyTripTotal').textContent = `${formatCurrency(total)} บาท`;
        }

        // Manager rotation calculation functions
        function updateManagerRotationCalculation() {
            const tbody = document.getElementById('managerRotationTableBody');
            const busCost = parseInt(document.getElementById('managerBusCost').value) || 600;
            const flightCost = parseInt(document.getElementById('managerFlightCost').value) || 4000;
            const taxiCost = parseInt(document.getElementById('managerTaxiCost').value) || 1000;
            
            const selectedEmployees = currentData.employees.filter(emp => 
                currentData.selectedEmployees.includes(emp.id) && emp.level === '7'
            );
            
            let total = 0;
            tbody.innerHTML = '';
            
            if (selectedEmployees.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-gray-500 py-8">
                            ไม่พบพนักงานระดับ 7
                        </td>
                    </tr>
                `;
            } else {
                selectedEmployees.forEach(emp => {
                    const rates = getRatesForEmployee(emp);
                    const perDiemCost = rates.perDiem * 7;
                    const accommodationCost = rates.hotel * 6;
                    const totalTravel = busCost + flightCost;
                    const empTotal = perDiemCost + accommodationCost + totalTravel + taxiCost;
                    total += empTotal;
                    
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-4 py-3 text-gray-600">${emp.id}</td>
                        <td class="px-4 py-3 font-medium">${emp.name}</td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(perDiemCost)}</div>
                            <div class="text-xs text-gray-500">(${formatCurrency(rates.perDiem)} × 7 วัน)</div>
                            <div class="text-xs text-blue-600">จากตารางมาตรฐาน</div>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(accommodationCost)}</div>
                            <div class="text-xs text-gray-500">(${formatCurrency(rates.hotel)} × 6 คืน)</div>
                            <div class="text-xs text-blue-600">จากตารางมาตรฐาน</div>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(totalTravel)}</div>
                            <div class="text-xs text-gray-500">รถ ${formatCurrency(busCost)} + เครื่องบิน ${formatCurrency(flightCost)}</div>
                            <div class="text-xs text-orange-600">ค่าคงที่ (แก้ไขได้)</div>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(taxiCost)}</div>
                            <div class="text-xs text-orange-600">ค่าคงที่ (แก้ไขได้)</div>
                        </td>
                        <td class="px-4 py-3 text-right font-bold">${formatCurrency(empTotal)}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            document.getElementById('managerRotationTotal').textContent = `${formatCurrency(total)} บาท`;
        }

        // Special assist 1 calculation functions
        function getSpecialAssist1DataForYear(year) {
            if (!currentData.specialAssist1DataByYear[year]) {
                currentData.specialAssist1DataByYear[year] = {
                    items: JSON.parse(JSON.stringify(defaultSpecialAssist1Data)),
                    notes: ''
                };
            }
            return currentData.specialAssist1DataByYear[year];
        }

        function updateSpecialAssist1Calculation() {
            const tbody = document.getElementById('specialAssist1TableBody');
            const year = currentData.specialAssist1CalcYear;
            const data = getSpecialAssist1DataForYear(year);
            
            let total = 0;
            tbody.innerHTML = '';
            
            if (data.items.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-gray-500 py-8">
                            ไม่มีรายการ
                        </td>
                    </tr>
                `;
            } else {
                data.items.forEach((item, index) => {
                    const itemTotal = item.timesPerYear * item.days * item.people * item.rate;
                    total += itemTotal;
                    
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-4 py-3">
                            <input type="text" class="form-input" value="${item.item}" 
                                   onchange="updateSpecialAssist1Item(${index}, 'item', this.value)">
                        </td>
                        <td class="px-4 py-3 text-center">
                            <input type="number" class="form-input text-center" value="${item.timesPerYear}" 
                                   onchange="updateSpecialAssist1Item(${index}, 'timesPerYear', this.value)">
                        </td>
                        <td class="px-4 py-3 text-center">
                            <input type="number" class="form-input text-center" value="${item.days}" 
                                   onchange="updateSpecialAssist1Item(${index}, 'days', this.value)">
                        </td>
                        <td class="px-4 py-3 text-center">
                            <input type="number" class="form-input text-center" value="${item.people}" 
                                   onchange="updateSpecialAssist1Item(${index}, 'people', this.value)">
                        </td>
                        <td class="px-4 py-3 text-right">
                            <input type="number" class="form-input text-right" value="${item.rate}" 
                                   onchange="updateSpecialAssist1Item(${index}, 'rate', this.value)">
                        </td>
                        <td class="px-4 py-3 text-right font-bold">
                            ${formatCurrency(itemTotal)}
                            <div class="text-xs text-gray-500 mt-1">
                                (${item.timesPerYear} × ${item.days} × ${item.people} × ${formatCurrency(item.rate)})
                            </div>
                        </td>
                        <td class="px-4 py-3 text-center">
                            <button class="btn btn-danger btn-sm" onclick="deleteSpecialAssist1Item(${index})">
                                <span class="icon">🗑️</span>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            document.getElementById('specialAssist1Total').textContent = `${formatCurrency(total)} บาท`;
            document.getElementById('specialAssist1Notes').value = data.notes || '';
        }

        function updateSpecialAssist1Item(index, key, value) {
            const year = currentData.specialAssist1CalcYear;
            const data = getSpecialAssist1DataForYear(year);
            const isNumeric = key !== 'item';
            data.items[index][key] = isNumeric ? (parseFloat(value) || 0) : value;
            updateSpecialAssist1Calculation();
        }

        function addSpecialAssist1Item() {
            const year = currentData.specialAssist1CalcYear;
            const data = getSpecialAssist1DataForYear(year);
            const newItem = {
                item: 'รายการใหม่',
                timesPerYear: 1,
                days: 1,
                people: 1,
                rate: 250
            };
            data.items.push(newItem);
            updateSpecialAssist1Calculation();
        }

        function deleteSpecialAssist1Item(index) {
            if (confirm('คุณต้องการลบรายการนี้ใช่หรือไม่?')) {
                const year = currentData.specialAssist1CalcYear;
                const data = getSpecialAssist1DataForYear(year);
                data.items.splice(index, 1);
                updateSpecialAssist1Calculation();
            }
        }

        function changeSpecialAssist1Year(delta) {
            currentData.specialAssist1CalcYear += delta;
            document.getElementById('specialAssist1CalcYear').textContent = currentData.specialAssist1CalcYear;
            updateSpecialAssist1Calculation();
        }

        // Overtime calculation functions
        function getOvertimeDataForYear(year) {
            if (!currentData.overtimeDataByYear[year]) {
                currentData.overtimeDataByYear[year] = {
                    salary: 15000,
                    items: [
                        { item: 'วันหยุดยาว 3 วัน', days: 3, instances: 0, hours: 8, people: 1 },
                        { item: 'วันหยุดยาว 4 วัน', days: 4, instances: 0, hours: 8, people: 1 },
                        { item: 'วันหยุดยาว 5 วัน', days: 5, instances: 0, hours: 8, people: 1 }
                    ]
                };
            }
            return currentData.overtimeDataByYear[year];
        }

        function calculateOvertimeRate(salary) {
            const dailyRate = salary / 30;
            const hourlyRate = dailyRate / 8;
            return hourlyRate * 1.5;
        }

        function updateOvertimeCalculation() {
            const tbody = document.getElementById('overtimeTableBody');
            const year = currentData.overtimeCalcYear;
            const data = getOvertimeDataForYear(year);
            const salary = parseInt(document.getElementById('overtimeSalary').value) || 15000;
            data.salary = salary;
            
            const overtimeRate = calculateOvertimeRate(salary);
            document.getElementById('overtimeRate').textContent = formatCurrency(overtimeRate);
            
            let total = 0;
            tbody.innerHTML = '';
            
            if (data.items.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center text-gray-500 py-8">
                            ไม่มีรายการ
                        </td>
                    </tr>
                `;
            } else {
                data.items.forEach((item, index) => {
                    const itemTotal = item.instances * item.days * item.hours * item.people * overtimeRate;
                    total += itemTotal;
                    
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-4 py-3">
                            <input type="text" class="form-input" value="${item.item}" 
                                   onchange="updateOvertimeItem(${index}, 'item', this.value)">
                        </td>
                        <td class="px-4 py-3 text-center">
                            <input type="number" class="form-input text-center" value="${item.instances}" 
                                   onchange="updateOvertimeItem(${index}, 'instances', this.value)">
                        </td>
                        <td class="px-4 py-3 text-center">
                            <input type="number" class="form-input text-center" value="${item.days}" 
                                   onchange="updateOvertimeItem(${index}, 'days', this.value)">
                        </td>
                        <td class="px-4 py-3 text-center">
                            <input type="number" class="form-input text-center" value="${item.hours}" 
                                   onchange="updateOvertimeItem(${index}, 'hours', this.value)">
                        </td>
                        <td class="px-4 py-3 text-center">
                            <input type="number" class="form-input text-center" value="${item.people}" 
                                   onchange="updateOvertimeItem(${index}, 'people', this.value)">
                        </td>
                        <td class="px-4 py-3 text-right">
                            <div>${formatCurrency(overtimeRate)}</div>
                            <div class="text-xs text-blue-600">คำนวณอัตโนมัติ</div>
                        </td>
                        <td class="px-4 py-3 text-right font-bold">
                            ${formatCurrency(itemTotal)}
                            <div class="text-xs text-gray-500 mt-1">
                                (${item.instances} × ${item.days} × ${item.hours} × ${item.people} × ${formatCurrency(overtimeRate)})
                            </div>
                        </td>
                        <td class="px-4 py-3 text-center">
                            <button class="btn btn-danger btn-sm" onclick="deleteOvertimeItem(${index})">
                                <span class="icon">🗑️</span>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            document.getElementById('overtimeTotal').textContent = `${formatCurrency(total)} บาท`;
        }

        function updateOvertimeItem(index, key, value) {
            const year = currentData.overtimeCalcYear;
            const data = getOvertimeDataForYear(year);
            const isNumeric = key !== 'item';
            data.items[index][key] = isNumeric ? (parseFloat(value) || 0) : value;
            updateOvertimeCalculation();
        }

        function addOvertimeItem() {
            const year = currentData.overtimeCalcYear;
            const data = getOvertimeDataForYear(year);
            const newItem = {
                item: 'รายการใหม่',
                instances: 1,
                days: 1,
                hours: 8,
                people: 1
            };
            data.items.push(newItem);
            updateOvertimeCalculation();
        }

        function deleteOvertimeItem(index) {
            if (confirm('คุณต้องการลบรายการนี้ใช่หรือไม่?')) {
                const year = currentData.overtimeCalcYear;
                const data = getOvertimeDataForYear(year);
                data.items.splice(index, 1);
                updateOvertimeCalculation();
            }
        }

        function changeOvertimeYear(delta) {
            currentData.overtimeCalcYear += delta;
            document.getElementById('overtimeCalcYear').textContent = currentData.overtimeCalcYear;
            updateOvertimeCalculation();
        }

        // Workday calculation functions
        function calculateWorkDays(year, holidays = []) {
            const yearCE = year - 543;
            let weekdays = 0;
            
            // Count weekdays (Monday to Friday)
            for (let m = 0; m < 12; m++) {
                const daysInMonth = new Date(yearCE, m + 1, 0).getDate();
                for (let d = 1; d <= daysInMonth; d++) {
                    const dayOfWeek = new Date(yearCE, m, d).getDay();
                    if (dayOfWeek > 0 && dayOfWeek < 6) {
                        weekdays++;
                    }
                }
            }
            
            // Count holidays that fall on weekdays
            let holidaysOnWeekdays = 0;
            holidays.forEach(holiday => {
                const date = new Date(holiday.date + 'T00:00:00');
                const dayOfWeek = date.getDay();
                if (dayOfWeek > 0 && dayOfWeek < 6) {
                    holidaysOnWeekdays++;
                }
            });
            
            return {
                weekdays,
                holidaysOnWeekdays,
                totalWorkDays: weekdays - holidaysOnWeekdays
            };
        }

        function updateWorkdayCalculation() {
            const year = currentData.workdayCalcYear;
            const yearCE = year - 543;
            const holidays = currentData.holidaysData[yearCE] || [];
            const workDayCalc = calculateWorkDays(year, holidays);
            
            document.getElementById('workdayResultYear').textContent = year;
            document.getElementById('totalWeekdays').textContent = `${workDayCalc.weekdays} วัน`;
            document.getElementById('holidaysOnWeekdays').textContent = `-${workDayCalc.holidaysOnWeekdays} วัน`;
            document.getElementById('actualWorkdays').textContent = `${workDayCalc.totalWorkDays} วัน`;
            
            updateHolidayList();
        }

        function updateHolidayList() {
            const year = currentData.workdayCalcYear;
            const yearCE = year - 543;
            const holidays = currentData.holidaysData[yearCE] || [];
            const holidayList = document.getElementById('holidayList');
            
            if (holidays.length === 0) {
                holidayList.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <span class="icon text-gray-300" style="font-size: 3rem;">📅</span>
                        <p>ไม่มีข้อมูลวันหยุดสำหรับปีนี้</p>
                        <p class="text-sm mt-1">เพิ่มวันหยุดใหม่เพื่อเริ่มต้นการคำนวณ</p>
                    </div>
                `;
            } else {
                holidayList.innerHTML = `
                    <div class="mb-3 p-3 bg-blue-50 rounded-lg">
                        <div class="text-sm text-blue-700">
                            <strong>สถิติปี ${year}:</strong> มีวันหยุดทั้งหมด ${holidays.length} วัน 
                            ตกในวันทำงาน ${calculateWorkDays(year, holidays).holidaysOnWeekdays} วัน
                        </div>
                    </div>
                    ${holidays.map((holiday, index) => `
                        <div class="flex items-center justify-between bg-white p-3 rounded-md shadow-sm border border-gray-200 hover:bg-gray-50">
                            <div class="flex-grow">
                                <span class="font-semibold text-blue-600">
                                    ${formatThaiDate(holiday.date)}
                                </span>
                                <span class="text-gray-700 ml-3">${holiday.name}</span>
                            </div>
                            <button class="btn btn-danger btn-sm" onclick="deleteHoliday(${index})">
                                <span class="icon">🗑️</span>
                            </button>
                        </div>
                    `).join('')}
                `;
            }
        }

        function formatThaiDate(dateStr) {
            const [year, month, day] = dateStr.split('-');
            return `${day}/${month}/${parseInt(year) + 543}`;
        }

        function addHoliday() {
            const dateInput = document.getElementById('newHolidayDate');
            const nameInput = document.getElementById('newHolidayName');
            
            if (!dateInput.value || !nameInput.value) {
                alert('กรุณาระบุวันที่และชื่อวันหยุด');
                return;
            }

            const year = currentData.workdayCalcYear;
            const yearCE = year - 543;
            
            if (!currentData.holidaysData[yearCE]) {
                currentData.holidaysData[yearCE] = [];
            }
            
            const newHoliday = {
                date: dateInput.value,
                name: nameInput.value
            };
            
            currentData.holidaysData[yearCE].push(newHoliday);
            currentData.holidaysData[yearCE].sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
            
            dateInput.value = '';
            nameInput.value = '';
            
            updateWorkdayCalculation();
        }

        function deleteHoliday(index) {
            if (confirm('คุณต้องการลบวันหยุดนี้ใช่หรือไม่?')) {
                const year = currentData.workdayCalcYear;
                const yearCE = year - 543;
                currentData.holidaysData[yearCE].splice(index, 1);
                updateWorkdayCalculation();
            }
        }

        function changeWorkdayYear(delta) {
            currentData.workdayCalcYear += delta;
            document.getElementById('workdayCalcYear').textContent = currentData.workdayCalcYear;
            updateWorkdayCalculation();
        }

        // Excel export functions
        function exportBudgetToExcel() {
            try {
                const currentYear = parseInt(document.getElementById('currentYear').value);
                const nextYear = parseInt(document.getElementById('nextYear').value);
                
                const dataRows = currentData.budgetData
                    .filter(item => item.code)
                    .map(item => {
                        const currentValue = item.values?.[currentYear] || 0;
                        const nextValue = item.values?.[nextYear] || 0;
                        return [
                            item.code,
                            item.name,
                            currentValue,
                            nextValue,
                            nextValue - currentValue,
                            item.notes || ''
                        ];
                    });

                const totalCurrent = dataRows.reduce((sum, row) => sum + row[2], 0);
                const totalNext = dataRows.reduce((sum, row) => sum + row[3], 0);
                const totalRow = ['', 'ยอดรวมทั้งหมด', totalCurrent, totalNext, totalNext - totalCurrent, ''];

                const headers = [
                    'รหัสบัญชี',
                    'รายการ',
                    `งบประมาณปี ${currentYear} (บาท)`,
                    `คำของบประมาณปี ${nextYear} (บาท)`,
                    'ผลต่าง (+/-)',
                    'หมายเหตุ'
                ];

                const csvContent = [headers, ...dataRows, totalRow]
                    .map(row => row.map(cell => `"${cell}"`).join(','))
                    .join('\n');

                const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `งบประมาณประจำปี_${currentYear}_vs_${nextYear}.csv`;
                link.click();
                
                showToast('ส่งออกข้อมูลงบประมาณเรียบร้อยแล้ว');
            } catch (error) {
                showToast('เกิดข้อผิดพลาดในการส่งออกข้อมูล', 'error');
            }
        }

        function exportEmployeesToExcel() {
            try {
                const headers = [
                    'รหัสพนักงาน',
                    'ชื่อ-สกุล',
                    'เพศ',
                    'ปี พ.ศ. เริ่มงาน',
                    'ระดับ',
                    'จังหวัดเยี่ยมบ้าน',
                    'ค่ารถทัวร์เยี่ยมบ้าน'
                ];

                const dataRows = currentData.employees.map(emp => [
                    emp.id,
                    emp.name,
                    emp.gender,
                    emp.startYear,
                    emp.level,
                    emp.visitProvince,
                    emp.homeVisitBusFare
                ]);

                const csvContent = [headers, ...dataRows]
                    .map(row => row.map(cell => `"${cell}"`).join(','))
                    .join('\n');

                const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'ข้อมูลพนักงาน.csv';
                link.click();
                
                showToast('ส่งออกข้อมูลพนักงานเรียบร้อยแล้ว');
            } catch (error) {
                showToast('เกิดข้อผิดพลาดในการส่งออกข้อมูล', 'error');
            }
        }

        function importEmployees(event) {
            const file = event.target.files?.[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const text = e.target.result;
                    const lines = text.split('\n');
                    const headers = lines[0].split(',').map(h => h.replace(/"/g, ''));
                    
                    const headerMapping = {
                        'รหัสพนักงาน': 'id',
                        'ชื่อ-สกุล': 'name',
                        'เพศ': 'gender',
                        'ปี พ.ศ. เริ่มงาน': 'startYear',
                        'ระดับ': 'level',
                        'จังหวัดเยี่ยมบ้าน': 'visitProvince',
                        'ค่ารถทัวร์เยี่ยมบ้าน': 'homeVisitBusFare'
                    };

                    const importedData = [];
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim()) {
                            const values = lines[i].split(',').map(v => v.replace(/"/g, ''));
                            const newEmp = {};
                            headers.forEach((header, index) => {
                                const jsKey = headerMapping[header];
                                if (jsKey) {
                                    let value = values[index] || '';
                                    if (jsKey === 'startYear' || jsKey === 'homeVisitBusFare') {
                                        value = parseFloat(value) || 0;
                                    }
                                    newEmp[jsKey] = value;
                                }
                            });
                            if (newEmp.id) {
                                importedData.push(newEmp);
                            }
                        }
                    }

                    currentData.employees = importedData;
                    currentData.selectedEmployees = importedData.map(emp => emp.id);
                    renderEmployeeTable();
                    updateCalculations();
                    showToast(`นำเข้าข้อมูลพนักงาน ${importedData.length} รายการเรียบร้อยแล้ว`);
                } catch (error) {
                    showToast('ไม่สามารถอ่านไฟล์ได้ กรุณาตรวจสอบรูปแบบไฟล์', 'error');
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        function resetAllData() {
            if (confirm('คุณต้องการลบข้อมูลที่บันทึกไว้ทั้งหมดและกลับไปใช้ค่าเริ่มต้นใช่หรือไม่? การกระทำนี้ไม่สามารถย้อนกลับได้')) {
                localStorage.removeItem('budgetSystem_data');
                initializeDefaultData();
                renderAll();
                showToast('ล้างข้อมูลเรียบร้อยแล้ว');
            }
        }

        // Update all calculations
        function updateCalculations() {
            updateTravelCalculation();
            updateSpecialAssistCalculation();
            updateFamilyVisitCalculation();
            updateCompanyTripCalculation();
            updateManagerRotationCalculation();
            updateSpecialAssist1Calculation();
            updateOvertimeCalculation();
            updateWorkdayCalculation();
        }

        // Render all components
        function renderAll() {
            renderBudgetTable();
            renderMasterRatesTable();
            renderEmployeeTable();
            updateCalculations();
        }

        // Event listeners
        document.getElementById('currentYear').addEventListener('change', renderBudgetTable);
        document.getElementById('nextYear').addEventListener('change', renderBudgetTable);
        document.getElementById('specialAssist1Notes').addEventListener('change', function() {
            const year = currentData.specialAssist1CalcYear;
            const data = getSpecialAssist1DataForYear(year);
            data.notes = this.value;
        });

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            initializeTabs();
            renderAll();
        });
    </script>
</body>
</html>